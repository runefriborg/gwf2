#!/Users/mailund/anaconda/bin/python

import argparse

from gwf.parser import parse
from gwf.dependency_graph import DependencyGraph
from gwf.graphviz import print_graphviz

parser = argparse.ArgumentParser(description='Show a workflow graph.')

parser.add_argument('-f', '--file',
                    default='workflow.gwf', dest='workflow_file',
                    help='Workflow file if not the default (workflow.gwf).')

parser.add_argument('output', nargs='?', default='workflow.dot',
                    help='File to write the workflow graph to.')

group = parser.add_mutually_exclusive_group()

group.add_argument('-a', '--all', default=False, action='store_true',
                   help='run all end targets in the workflow')
group.add_argument('-t', '--targets', nargs='+',
                   help='the target(s) to process.')

args = parser.parse_args()

workflow = parse(args.workflow_file, args.targets, args.all)
graph = DependencyGraph(workflow)

with open(args.output, 'w') as out:
    print_graphviz(graph, out)
